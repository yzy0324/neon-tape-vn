<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>éœ“è™¹ç£å¸¦ï¼šå¤œèˆªè°ƒé…’å½•</title>
  <style>
    :root {
      --bg-1:#13051f;--bg-2:#1f0d3b;--sunset:#ff8a5b;--sunset-2:#ff4f8b;--neon-cyan:#2ff3e0;--text:#ffd8e8;--panel:rgba(18,9,40,.9);--line:rgba(255,132,214,.42);
    }
    *{box-sizing:border-box} body{margin:0;min-height:100vh;font-family:"Microsoft YaHei","Noto Sans SC",sans-serif;color:var(--text);background:radial-gradient(circle at 50% 15%,#47256e 0%,var(--bg-2) 35%,var(--bg-1) 70%);overflow:hidden}
    body::before{content:"";position:fixed;inset:0;pointer-events:none;background:repeating-linear-gradient(to bottom,rgba(255,255,255,.04),rgba(255,255,255,.04) 1px,transparent 2px,transparent 4px);mix-blend-mode:screen;opacity:.28}
    .sun{position:fixed;top:5vh;left:50%;transform:translateX(-50%);width:min(64vw,520px);height:min(64vw,520px);border-radius:50%;background:linear-gradient(to bottom,#ffd26f 5%,var(--sunset) 35%,var(--sunset-2) 75%);box-shadow:0 0 46px rgba(255,123,176,.42);overflow:hidden;opacity:.42}
    .sun::after{content:"";position:absolute;inset:0;background:repeating-linear-gradient(to bottom,transparent 0,transparent 20px,rgba(31,13,59,.76) 20px,rgba(31,13,59,.76) 26px)}
    .grid{position:fixed;left:0;right:0;bottom:0;height:45vh;background:linear-gradient(to top,rgba(255,80,160,.08),transparent 65%),repeating-linear-gradient(to right,rgba(47,243,224,.2),rgba(47,243,224,.2) 1px,transparent 1px,transparent 50px),repeating-linear-gradient(to top,rgba(47,243,224,.2),rgba(47,243,224,.2) 1px,transparent 1px,transparent 50px);transform:perspective(220px) rotateX(58deg);transform-origin:bottom;opacity:.42}
    .app{position:relative;z-index:2;width:min(1080px,96vw);margin:2vh auto;display:grid;grid-template-columns:320px 1fr;gap:16px;height:94vh}
    .left,.right{border:1px solid var(--line);background:var(--panel);box-shadow:0 0 18px rgba(142,88,255,.36),inset 0 0 20px rgba(255,82,160,.16);border-radius:12px;backdrop-filter:blur(4px)}
    .left{padding:12px;display:flex;flex-direction:column;gap:10px}
    .cassette{border:1px solid rgba(255,215,173,.3);border-radius:10px;padding:10px;background:linear-gradient(135deg,rgba(255,152,134,.18),rgba(72,29,103,.55))}
    .cassette h2{margin:0;font-size:16px;letter-spacing:1px;color:#ffd787}.tiny{font-size:12px;opacity:.9}
    .portrait-wrap{position:relative;border:1px solid rgba(255,142,191,.35);border-radius:10px;background:rgba(8,5,22,.8);display:grid;place-items:center;min-height:156px;overflow:hidden}.portrait-wrap::before{content:"";position:absolute;inset:0;pointer-events:none;background:repeating-linear-gradient(to bottom,rgba(255,255,255,.08),rgba(255,255,255,.08) 1px,transparent 1px,transparent 4px);mix-blend-mode:screen;opacity:.18;animation:portraitScan 2.2s steps(6,end) infinite}.portrait{width:96px;height:144px;max-width:100%;max-height:calc(100vw - 48px);border-radius:6px;image-rendering:pixelated;object-fit:contain;transition:opacity .14s ease;opacity:1}.portrait-switching{opacity:.82}
    .stats{display:grid;gap:8px;font-size:13px}.bar{height:8px;border-radius:4px;background:rgba(255,255,255,.15);overflow:hidden;margin-top:3px}.bar>span{display:block;height:100%;width:50%;background:linear-gradient(to right,var(--neon-cyan),#ffe37f);box-shadow:0 0 10px rgba(47,243,224,.7);transition:width .25s ease}
    .log{border:1px solid rgba(255,190,140,.35);border-radius:8px;padding:8px;background:rgba(10,5,28,.72);height:180px;overflow:auto;font-size:12px;line-height:1.55}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:auto}
    .save-panel,.archive-panel{position:fixed;inset:0;display:none;place-items:center;background:rgba(5,3,20,.68);backdrop-filter:blur(2px);z-index:8}
    .save-panel.open,.archive-panel.open{display:grid}
    .save-shell{width:min(920px,94vw);max-height:88vh;overflow:auto;border:1px solid var(--line);border-radius:14px;background:linear-gradient(145deg,rgba(30,15,60,.95),rgba(15,10,38,.96));box-shadow:0 0 18px rgba(255,80,160,.35), inset 0 0 18px rgba(47,243,224,.12);padding:14px}
    .save-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .slots{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:8px}
    .slot{border:1px solid rgba(255,205,141,.35);border-radius:10px;padding:8px;background:rgba(18,9,40,.7)}
    .slot h4{margin:0 0 8px 0;color:#ffe38b}
    .slot .row{display:grid;grid-template-columns:1fr 1fr;gap:6px}
    .transfer{margin-top:12px;display:grid;gap:8px}
    .transfer textarea{width:100%;min-height:140px;border-radius:10px;border:1px solid rgba(47,243,224,.35);background:rgba(8,5,22,.9);color:#ffd8e8;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;font-size:12px}
    .status{font-size:12px;color:#9df3df;min-height:18px}
    .archive-shell{width:min(720px,94vw);max-height:82vh;overflow:auto;border:1px solid var(--line);border-radius:14px;background:linear-gradient(145deg,rgba(30,15,60,.95),rgba(15,10,38,.96));padding:14px}
    .archive-body ul{margin:6px 0 12px 18px;padding:0}
    .archive-rel{display:grid;grid-template-columns:120px 1fr 24px;gap:8px;align-items:center;font-size:12px;margin-bottom:6px}
    .ending-run{border:1px solid rgba(255,205,141,.3);border-radius:10px;padding:10px;margin:10px 0;background:rgba(17,8,36,.6)}
    .ending-run h4{margin:0 0 8px;color:#ffe38b}
    .ending-run ol{margin:6px 0 8px 18px;padding:0;font-size:12px}
    .flow-card{margin-top:10px;padding-top:8px;border-top:1px dashed rgba(255,225,170,.35)}
    .flow-svg{width:100%;height:auto;border:1px solid rgba(47,243,224,.25);border-radius:8px;background:rgba(8,5,22,.65)}
    .volume-wrap{grid-column:1/-1;border:1px solid rgba(255,205,141,.35);border-radius:10px;padding:8px;background:rgba(18,9,40,.7)}
    .volume-wrap input{width:100%}
    button{border:1px solid rgba(255,205,141,.5);border-radius:8px;padding:8px;background:linear-gradient(120deg,rgba(255,138,91,.2),rgba(142,88,255,.3));color:#fff3dd;cursor:pointer;font-size:13px}
    button:hover{transform:translateY(-1px);box-shadow:0 0 10px rgba(255,150,190,.5)}
    .right{display:flex;flex-direction:column;overflow:hidden}
    .scene-head{padding:12px 16px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;font-size:14px;gap:10px;flex-wrap:wrap}
    .playback-controls{display:flex;gap:8px;flex-wrap:wrap}
    .playback-controls button{padding:6px 10px;font-size:12px}
    .playback-controls button.active{box-shadow:0 0 12px rgba(47,243,224,.48);border-color:rgba(47,243,224,.75)}
    .story{flex:1;padding:18px;overflow:auto;line-height:1.7;font-size:16px;text-shadow:0 0 6px rgba(255,116,179,.2);white-space:pre-line}
    .choices{padding:12px;border-top:1px solid var(--line);display:grid;gap:8px;background:rgba(10,5,28,.78)}
    .drink-panel{display:grid;gap:8px;border:1px solid rgba(47,243,224,.35);border-radius:10px;padding:10px;background:rgba(16,9,36,.88)}
    .drink-head{font-size:14px;color:#ffdca7}
    .drink-note{font-size:12px;color:#9df3df}
    .drink-panel select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,205,141,.5);background:rgba(8,5,22,.9);color:#ffe9f3}
    .drink-extras{display:grid;grid-template-columns:repeat(2,minmax(120px,1fr));gap:6px}
    .extra-item{font-size:12px;border:1px solid rgba(255,132,214,.35);border-radius:8px;padding:6px;background:rgba(22,12,48,.7)}
    .drink-preview{font-size:12px;color:#ffe38b;line-height:1.5}
    .serve-btn{background:linear-gradient(120deg,rgba(47,243,224,.2),rgba(142,88,255,.34))}
    .history-panel{position:fixed;right:18px;bottom:18px;width:min(460px,92vw);max-height:min(58vh,520px);display:none;flex-direction:column;border:1px solid var(--line);border-radius:12px;background:rgba(14,8,34,.95);box-shadow:0 0 16px rgba(47,243,224,.24);z-index:9}
    .history-panel.open{display:flex}
    .history-panel .head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid rgba(255,132,214,.3)}
    .history-panel .body{padding:10px 12px;overflow:auto;display:grid;gap:8px;font-size:13px;line-height:1.5}
    .history-item{padding:8px;border:1px solid rgba(255,205,141,.25);border-radius:8px;background:rgba(20,12,46,.72)}
    .history-item .meta{font-size:11px;color:#9df3df;margin-bottom:4px}
    .bg-layer{position:absolute;inset:0;pointer-events:none;opacity:.2;background-size:cover;transition:opacity .3s}@keyframes portraitScan{0%{transform:translateY(-2px);opacity:.16}50%{transform:translateY(2px);opacity:.24}100%{transform:translateY(-2px);opacity:.16}}
    @media (max-width:860px){.app{grid-template-columns:1fr;height:auto;margin-bottom:2vh}.left{order:2}.right{min-height:70vh}.portrait-wrap{min-height:150px}.portrait{max-height:55vw}}
  </style>
</head>
<body>
  <div class="sun"></div><div class="grid"></div>
  <main class="app">
    <aside class="left">
      <div class="cassette"><h2>NEON TAPE_017</h2><div class="tiny">èº«ä»½ï¼šå¤œèˆªè°ƒé…’å¸ˆ / æƒ…æŠ¥ä¸­ç»§å‘˜ã€Œé›¶ç£ã€</div></div>
      <div class="portrait-wrap"><img id="portrait" class="portrait" alt="è§’è‰²åƒç´ ç«‹ç»˜" /></div>
      <div id="charInfo" class="tiny"></div>
      <div id="routeHint" class="tiny">è·¯çº¿è¶‹è¿‘æç¤ºï¼šå°šæœªå¼€å§‹ã€‚</div>
      <div class="stats">
        <div>ç†æ€§ â†” æ„Ÿæ€§<div class="bar"><span id="barLogic"></span></div></div>
        <div>åˆä½œ â†” å¯¹æŠ—<div class="bar"><span id="barCoop"></span></div></div>
        <div>æ¢ç´¢ â†” ä¿å®ˆ<div class="bar"><span id="barExplore"></span></div></div>
      </div>
      <div class="tiny">å‰§æƒ…æ—¥å¿—ï¼ˆå¯å›çœ‹ï¼‰</div>
      <div id="logPanel" class="log"></div>
      <div class="controls">
        <button id="savePanelBtn">ç£å¸¦å­˜æ¡£é¢æ¿</button><button id="archivePanelBtn">çº¿ç´¢æ¿/æ¡£æ¡ˆ</button>
        <button id="endingPanelBtn">ç»“å±€æ¡£æ¡ˆé¦†</button>
        <button id="bgmBtn">å¼€å¯ BGM</button>
        <button id="resetBtn">é‡å¼€æœ¬å±€</button><button data-load="auto">è¯»å–è‡ªåŠ¨å­˜æ¡£</button>
      </div>
    </aside>
    <section class="right">
      <div class="scene-head"><strong id="sceneTitle">åºç« </strong><span id="clock">22:11 / é›¨å¤œ</span><div class="playback-controls"><button id="showAllBtn">å…¨æ–‡</button><button id="autoBtn">Auto</button><button id="skipBtn">Skip</button><button id="historyBtn">History</button></div></div>
      <div class="bg-layer" id="bgLayer"></div>
      <div id="story" class="story"></div>
      <div id="choices" class="choices"></div>
    </section>
  </main>

  <div class="save-panel" id="savePanel" aria-hidden="true">
    <section class="save-shell">
      <div class="save-head">
        <strong>ğŸ“¼ Tape Archive / å­˜æ¡£æ€»çº¿</strong>
        <button id="savePanelClose">å…³é—­</button>
      </div>
      <div class="slots">
        <div class="slot"><h4>Slot1</h4><div class="row"><button data-save="slot1">ä¿å­˜</button><button data-load="slot1">è¯»å–</button><button data-export="slot1">å¯¼å‡º</button><button data-import="slot1">å¯¼å…¥</button></div></div>
        <div class="slot"><h4>Slot2</h4><div class="row"><button data-save="slot2">ä¿å­˜</button><button data-load="slot2">è¯»å–</button><button data-export="slot2">å¯¼å‡º</button><button data-import="slot2">å¯¼å…¥</button></div></div>
        <div class="slot"><h4>Slot3</h4><div class="row"><button data-save="slot3">ä¿å­˜</button><button data-load="slot3">è¯»å–</button><button data-export="slot3">å¯¼å‡º</button><button data-import="slot3">å¯¼å…¥</button></div></div>
        <div class="slot"><h4>Auto</h4><div class="row"><button data-save="auto">ä¿å­˜</button><button data-load="auto">è¯»å–</button><button data-export="auto">å¯¼å‡º</button><button data-import="auto">å¯¼å…¥</button></div></div>
        <div class="volume-wrap">
          <div class="tiny">BGM éŸ³é‡ï¼š<span id="bgmVolumeLabel">50%</span></div>
          <input id="bgmVolume" type="range" min="0" max="100" step="1" value="50" />
        </div>
      </div>
      <div class="transfer">
        <div class="tiny">å¯¼å‡ºå°†å°è¯•å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼›å¯¼å…¥å‰è¯·ç²˜è´´å®Œæ•´ JSONï¼ˆåŒ…å« schemaVersionï¼‰ã€‚</div>
        <textarea id="saveTransferText" placeholder="åœ¨æ­¤ç²˜è´´æˆ–æŸ¥çœ‹å­˜æ¡£ JSON"></textarea>
        <div id="saveStatus" class="status"></div>
      </div>
    </section>
  </div>

  <div class="archive-panel" id="archivePanel" aria-hidden="true">
    <section class="archive-shell">
      <div class="save-head">
        <strong>ğŸ§· çº¿ç´¢æ¿ / æ¡£æ¡ˆ</strong>
        <button id="archivePanelClose">å…³é—­</button>
      </div>
      <div id="archiveBody" class="archive-body"></div>
    </section>
  </div>

  <div class="archive-panel" id="endingPanel" aria-hidden="true">
    <section class="archive-shell">
      <div class="save-head">
        <strong>ğŸ ç»“å±€æ¡£æ¡ˆé¦†</strong>
        <button id="endingPanelClose">å…³é—­</button>
      </div>
      <div id="endingBody" class="archive-body"></div>
    </section>
  </div>

  <div class="history-panel" id="historyPanel" aria-hidden="true">
    <div class="head">
      <strong>ğŸ•˜ å†å²å›æ”¾ï¼ˆæœ€è¿‘ 40 æ¡ï¼‰</strong>
      <button id="historyClose">å…³é—­</button>
    </div>
    <div id="historyBody" class="body"></div>
  </div>
  <script type="module" src="js/main.js"></script>
</body>
</html>
